<div class="checkout-page">
  <div class="container">
    <header class="page-header">
      <h1 class="page-title">إتمام الشراء</h1>
    </header>

    <!-- حالة نجاح الطلب -->
    <div *ngIf="orderPlaced" class="order-success-container">
      <div class="order-success-content">
        <i class="fas fa-check-circle success-icon"></i>
        <h2>تم استلام طلبك بنجاح!</h2>
        <p>شكراً لك على ثقتك في نضيد الوشم. سيتم معالجة طلبك وتجهيزه للشحن في أقرب وقت.</p>
        <a [routerLink]="['/']" class="btn btn-primary btn-lg mt-3">العودة للرئيسية</a>
      </div>
    </div>

    <!-- حالة السلة الفارغة -->
    <div *ngIf="!orderPlaced && cartItems.length === 0" class="empty-cart-container">
      <div class="empty-cart-content">
        <i class="fas fa-exclamation-triangle warning-icon"></i>
        <h3>لا يمكن إتمام الشراء</h3>
        <p>سلتك فارغة حالياً. يرجى إضافة بعض المنتجات أولاً لتتمكن من المتابعة.</p>
        <a [routerLink]="['/products']" class="btn btn-primary btn-lg mt-3">تصفح المنتجات</a>
      </div>
    </div>

    <!-- فورم إتمام الشراء -->
    <form *ngIf="!orderPlaced && cartItems.length > 0" (ngSubmit)="placeOrder()">
      <div class="row g-4">
        <!-- الجزء الأيسر: تفاصيل الشحن والدفع -->
        <div class="col-lg-7">
          <div class="checkout-section">
            <h2 class="section-title">1. تفاصيل الشحن</h2>
            <div *ngIf="orderError" class="alert alert-danger">{{ orderError }}</div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="firstName" class="form-label">الاسم الأول</label>
                <input type="text" id="firstName" class="form-control" [(ngModel)]="checkoutForm.firstName" name="firstName" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="lastName" class="form-label">الاسم الأخير</label>
                <input type="text" id="lastName" class="form-control" [(ngModel)]="checkoutForm.lastName" name="lastName" required>
              </div>
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">البريد الإلكتروني</label>
              <input type="email" id="email" class="form-control" [(ngModel)]="checkoutForm.email" name="email" required>
            </div>
            <div class="mb-3">
              <label for="phone" class="form-label">رقم الجوال</label>
              <input type="tel" id="phone" class="form-control" [(ngModel)]="checkoutForm.phone" name="phone" required>
            </div>
            <div class="mb-3">
              <label for="address" class="form-label">العنوان التفصيلي (الحي، الشارع، رقم المنزل)</label>
              <input type="text" id="address" class="form-control" [(ngModel)]="checkoutForm.address" name="address" required>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="city" class="form-label">المدينة</label>
                <input type="text" id="city" class="form-control" [(ngModel)]="checkoutForm.city" name="city" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="country" class="form-label">الدولة</label>
                <input type="text" id="country" class="form-control" value="المملكة العربية السعودية" disabled>
              </div>
            </div>
          </div>

          <div class="checkout-section mt-4">
            <h2 class="section-title">2. طريقة الدفع</h2>
            <div class="payment-options">
              <div class="form-check payment-option">
                <input class="form-check-input" type="radio" name="paymentMethod" id="cod" value="cod" [(ngModel)]="checkoutForm.paymentMethod">
                <label class="form-check-label" for="cod">
                  <i class="fas fa-money-bill-wave"></i>
                  <span>الدفع عند الاستلام</span>
                  <small>ادفع نقدًا لمندوب التوصيل عند استلام طلبك.</small>
                </label>
              </div>
              <div class="form-check payment-option disabled">
                <input class="form-check-input" type="radio" name="paymentMethod" id="creditCard" value="creditCard" [(ngModel)]="checkoutForm.paymentMethod" disabled>
                <label class="form-check-label" for="creditCard">
                  <i class="fas fa-credit-card"></i>
                  <span>بطاقة ائتمانية</span>
                  <small>هذه الخدمة ستكون متاحة قريباً.</small>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- الجزء الأيمن: ملخص الطلب -->
        <div class="col-lg-5">
          <div class="order-summary">
            <h2 class="section-title">ملخص طلبك</h2>
            <div class="summary-items-list">
              <div class="summary-item" *ngFor="let item of cartItems">
                <img [src]="item.image" [alt]="item.name" class="item-thumbnail">
                <div class="item-info">
                  <span class="item-name">{{ item.name }}</span>
                  <span class="item-quantity">الكمية: {{ item.quantity }}</span>
                </div>
                <span class="item-price">{{ item.price * item.quantity }}
                  <svg class="riyal-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1124.14 1256.39">
                    <path fill="currentColor" d="M699.62,1113.02h0c-20.06,44.48-33.32,92.75-38.4,143.37l424.51-90.24c20.06-44.47,33.31-92.75,38.4-143.37l-424.51,90.24Z"></path>
                    <path fill="currentColor" d="M1085.73,895.8c20.06-44.47,33.32-92.75,38.4-143.37l-330.68,70.33v-135.2l292.27-62.11c20.06-44.47,33.32-92.75,38.4-143.37l-330.68,70.27V66.13c-50.67,28.45-95.67,66.32-132.25,110.99v403.35l-132.25,28.11V0c-50.67,28.44-95.67,66.32-132.25,110.99v525.69l-295.91,62.88c-20.06,44.47-33.33,92.75-38.42,143.37l334.33-71.05v170.26l-358.3,76.14c-20.06,44.47-33.32,92.75-38.4,143.37l375.04-79.7c30.53-6.35,56.77-24.4,73.83-49.24l68.78-101.97v-.02c7.14-10.55,11.3-23.27,11.3-36.97v-149.98l132.25-28.11v270.4l424.53-90.28Z"></path>
                  </svg>
                </span>
              </div>
            </div>
            <div class="summary-calculation">
              <div class="summary-row">
                <span>إجمالي المنتجات</span>
                <span>{{ cartTotal}}
                  <svg class="riyal-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1124.14 1256.39">
                    <path fill="currentColor" d="M699.62,1113.02h0c-20.06,44.48-33.32,92.75-38.4,143.37l424.51-90.24c20.06-44.47,33.31-92.75,38.4-143.37l-424.51,90.24Z"></path>
                    <path fill="currentColor" d="M1085.73,895.8c20.06-44.47,33.32-92.75,38.4-143.37l-330.68,70.33v-135.2l292.27-62.11c20.06-44.47,33.32-92.75,38.4-143.37l-330.68,70.27V66.13c-50.67,28.45-95.67,66.32-132.25,110.99v403.35l-132.25,28.11V0c-50.67,28.44-95.67,66.32-132.25,110.99v525.69l-295.91,62.88c-20.06,44.47-33.33,92.75-38.42,143.37l334.33-71.05v170.26l-358.3,76.14c-20.06,44.47-33.32,92.75-38.4,143.37l375.04-79.7c30.53-6.35,56.77-24.4,73.83-49.24l68.78-101.97v-.02c7.14-10.55,11.3-23.27,11.3-36.97v-149.98l132.25-28.11v270.4l424.53-90.28Z"></path>
                  </svg>
                </span>
              </div>
              <div class="summary-row">
                <span>تكلفة الشحن</span>
                <span>{{ shippingCost}}
                  <svg class="riyal-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1124.14 1256.39">
                    <path fill="currentColor" d="M699.62,1113.02h0c-20.06,44.48-33.32,92.75-38.4,143.37l424.51-90.24c20.06-44.47,33.31-92.75,38.4-143.37l-424.51,90.24Z"></path>
                    <path fill="currentColor" d="M1085.73,895.8c20.06-44.47,33.32-92.75,38.4-143.37l-330.68,70.33v-135.2l292.27-62.11c20.06-44.47,33.32-92.75,38.4-143.37l-330.68,70.27V66.13c-50.67,28.45-95.67,66.32-132.25,110.99v403.35l-132.25,28.11V0c-50.67,28.44-95.67,66.32-132.25,110.99v525.69l-295.91,62.88c-20.06,44.47-33.33,92.75-38.42,143.37l334.33-71.05v170.26l-358.3,76.14c-20.06,44.47-33.32,92.75-38.4,143.37l375.04-79.7c30.53-6.35,56.77-24.4,73.83-49.24l68.78-101.97v-.02c7.14-10.55,11.3-23.27,11.3-36.97v-149.98l132.25-28.11v270.4l424.53-90.28Z"></path>
                  </svg>
                </span>
              </div>
              <hr>
              <div class="summary-row grand-total">
                <span>المجموع الكلي</span>
                <span>{{ grandTotal}}
                  <svg class="riyal-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1124.14 1256.39">
                    <path fill="currentColor" d="M699.62,1113.02h0c-20.06,44.48-33.32,92.75-38.4,143.37l424.51-90.24c20.06-44.47,33.31-92.75,38.4-143.37l-424.51,90.24Z"></path>
                    <path fill="currentColor" d="M1085.73,895.8c20.06-44.47,33.32-92.75,38.4-143.37l-330.68,70.33v-135.2l292.27-62.11c20.06-44.47,33.32-92.75,38.4-143.37l-330.68,70.27V66.13c-50.67,28.45-95.67,66.32-132.25,110.99v403.35l-132.25,28.11V0c-50.67,28.44-95.67,66.32-132.25,110.99v525.69l-295.91,62.88c-20.06,44.47-33.33,92.75-38.42,143.37l334.33-71.05v170.26l-358.3,76.14c-20.06,44.47-33.32,92.75-38.4,143.37l375.04-79.7c30.53-6.35,56.77-24.4,73.83-49.24l68.78-101.97v-.02c7.14-10.55,11.3-23.27,11.3-36.97v-149.98l132.25-28.11v270.4l424.53-90.28Z"></path>
                  </svg>
                </span>
              </div>
            </div>
            <button type="submit" class="btn btn-primary btn-lg w-100 mt-4" [disabled]="isSubmitting">
              <span *ngIf="!isSubmitting"><i class="fas fa-lock"></i> تأكيد الطلب الآن</span>
              <span *ngIf="isSubmitting"><i class="fas fa-spinner fa-spin"></i> جاري إتمام الطلب...</span>
            </button>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
